<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø±Ø¯Ø´Ø© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ø¹ Gemini</title>
    <style>
        /* (Ù†ÙØ³ ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ø§Ù„Ø±Ø§Ø¦Ø¹Ø© Ø§Ù„ØªÙŠ ÙˆØ¶Ø¹ØªÙ‡Ø§ Ø³Ø§Ø¨Ù‚Ø§Ù‹) */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #1a237e 0%, #311b92 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; color: #333; }
        .chat-container { width: 100%; max-width: 1000px; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); overflow: hidden; display: flex; flex-direction: column; height: 90vh; }
        .chat-header { background: linear-gradient(90deg, #4285f4 0%, #34a853 100%); color: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; }
        .chat-header h1 { font-size: 24px; display: flex; align-items: center; gap: 15px; font-weight: 600; }
        .logo { background: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #4285f4; font-weight: bold; font-size: 20px; }
        .api-status { background: rgba(255, 255, 255, 0.2); padding: 8px 20px; border-radius: 25px; font-size: 14px; display: flex; align-items: center; gap: 10px; backdrop-filter: blur(10px); }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background: #34a853; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .chat-box { flex: 1; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; background: #f8f9fa; }
        .message { max-width: 80%; padding: 18px 22px; border-radius: 22px; line-height: 1.6; word-wrap: break-word; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); animation: fadeIn 0.4s ease; position: relative; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .user-message { align-self: flex-end; background: linear-gradient(135deg, #4285f4, #34a853); color: white; border-bottom-right-radius: 5px; }
        .bot-message { align-self: flex-start; background: white; color: #1a1a1a; border: 1px solid #e1e5e9; border-bottom-left-radius: 5px; }
        .message-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 14px; opacity: 0.9; }
        .message-sender { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .message-time { font-size: 12px; opacity: 0.7; }
        .message-content { font-size: 16px; line-height: 1.7; }
        .bot-icon, .user-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .bot-icon { background: #4285f4; color: white; }
        .user-icon { background: white; color: #4285f4; font-weight: bold; }
        .input-area { padding: 25px; border-top: 1px solid #eef2f7; background: white; display: flex; gap: 20px; align-items: center; }
        #user-input { flex: 1; padding: 18px 25px; border: 2px solid #e1e5e9; border-radius: 18px; font-size: 16px; outline: none; transition: all 0.3s; background: #f8f9fa; resize: none; min-height: 60px; max-height: 150px; }
        #send-btn { background: linear-gradient(135deg, #4285f4 0%, #34a853 100%); color: white; border: none; border-radius: 18px; padding: 0 40px; height: 60px; font-size: 17px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 12px; }
        #send-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .typing-indicator { align-self: flex-start; background: white; padding: 20px 25px; border-radius: 22px; border: 1px solid #e1e5e9; display: none; }
        .api-settings { background: #f8f9fa; padding: 25px 30px; border-top: 1px solid #eef2f7; border-bottom: 1px solid #eef2f7; display: none; }
        .settings-control { text-align: center; padding: 20px; background: white; }
        .toggle-settings { background: transparent; border: 2px solid #e1e5e9; padding: 12px 30px; border-radius: 12px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1><span class="logo">G</span> Ø¯Ø±Ø¯Ø´Ø© Gemini Ø§Ù„Ø°ÙƒÙŠØ©</h1>
            <div class="api-status">
                <span class="status-dot"></span>
                <span id="status-text">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§ØªØµØ§Ù„</span>
            </div>
        </div>
        
        <div class="api-settings" id="api-settings">
            <div style="margin-bottom: 20px;">
                <label style="display:block; margin-bottom:10px; font-weight:600;">ğŸ”‘ Ù…ÙØªØ§Ø­ Google Gemini API:</label>
                <input type="text" id="api-key-input" style="width:100%; padding:15px; border-radius:10px; border:2px solid #ddd;" placeholder="AIza...">
            </div>
        </div>
        
        <div class="chat-box" id="chat-box">
            <div class="typing-indicator" id="typing-indicator">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...</div>
        </div>
        
        <div class="input-area">
            <textarea id="user-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." rows="1"></textarea>
            <button id="send-btn">Ø¥Ø±Ø³Ø§Ù„ â†—ï¸</button>
        </div>
        
        <div class="settings-control">
            <button class="toggle-settings" id="toggle-settings">âš™ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API</button>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiSettings = document.getElementById('api-settings');
        const toggleSettingsBtn = document.getElementById('toggle-settings'); // ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù‡Ù†Ø§
        const statusText = document.getElementById('status-text');

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø­ÙÙˆØ¸
        window.onload = () => {
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) { apiKeyInput.value = savedKey; updateApiStatus(); }
        };

        // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        toggleSettingsBtn.addEventListener('click', () => {
            const isHidden = apiSettings.style.display === 'none' || apiSettings.style.display === '';
            apiSettings.style.display = isHidden ? 'block' : 'none';
            toggleSettingsBtn.textContent = isHidden ? 'âš™ï¸ Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API' : 'âš™ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API';
        });

        apiKeyInput.addEventListener('input', () => {
            localStorage.setItem('gemini_api_key', apiKeyInput.value.trim());
            updateApiStatus();
        });

        function updateApiStatus() {
            const key = apiKeyInput.value.trim();
            statusText.textContent = key.startsWith('AIza') ? 'ğŸŸ¢ Ø¬Ø§Ù‡Ø²' : 'ğŸ”´ Ù…ÙØªØ§Ø­ ØºÙŠØ± ØµØ§Ù„Ø­';
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            const key = apiKeyInput.value.trim();
            if (!text || !key) return;

            addMessage(text, 'user');
            userInput.value = '';
            typingIndicator.style.display = 'block';
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: text }] }]
                    })
                });

                const data = await response.json();
                typingIndicator.style.display = 'none';

                if (data.candidates && data.candidates[0].content) {
                    addMessage(data.candidates[0].content.parts[0].text, 'bot');
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø¯');
                }
            } catch (error) {
                typingIndicator.style.display = 'none';
                addMessage('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'bot');
            }
        }

        function addMessage(text, sender) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}-message`;
            
            // ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø·ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚
            const formattedText = text.replace(/\n/g, '<br>');
            
            msgDiv.innerHTML = `
                <div class="message-header">
                    <span class="message-sender">${sender === 'user' ? 'Ø£Ù†Øª' : 'Gemini'}</span>
                    <span class="message-time">${new Date().toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'})}</span>
                </div>
                <div class="message-content">${formattedText}</div>
            `;
            chatBox.insertBefore(msgDiv, typingIndicator);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } });
    </script>
</body>
</html>
